<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Workbook for Rust &amp; QT workshop</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Rust and QT</a></li><li class="chapter-item expanded "><a href="preparations.html"><strong aria-hidden="true">1.</strong> Preparations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="setup.html"><strong aria-hidden="true">1.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="tooling-check.html"><strong aria-hidden="true">1.2.</strong> Tooling check</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Background</li><li class="chapter-item expanded "><a href="what-is-webassembly.html"><strong aria-hidden="true">2.</strong> What is WebAssembly?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wasm-hello-world.html"><strong aria-hidden="true">2.1.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="rust-and-wasm.html"><strong aria-hidden="true">2.2.</strong> Rust & Wasm</a></li></ol></li><li class="chapter-item expanded "><a href="on-the-web/usecases.html"><strong aria-hidden="true">3.</strong> Use cases on the web</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="on-the-web/wasm-and-js.html"><strong aria-hidden="true">3.1.</strong> WASM & JavaScript</a></li></ol></li><li class="chapter-item expanded "><a href="on-the-server/usecases.html"><strong aria-hidden="true">4.</strong> Use cases everywhere else</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="on-the-server/wasi.html"><strong aria-hidden="true">4.1.</strong> WASI</a></li><li class="chapter-item expanded "><a href="on-the-server/compute-at-edge.html"><strong aria-hidden="true">4.2.</strong> Fastly's Compute@Edge</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tutorial</li><li class="chapter-item expanded "><a href="tutorial/index.html"><strong aria-hidden="true">5.</strong> Idea</a></li><li class="chapter-item expanded "><a href="tutorial/cli.html"><strong aria-hidden="true">6.</strong> CLI</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorial/cli/hello-world.html"><strong aria-hidden="true">6.1.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="tutorial/cli/building-cli.html"><strong aria-hidden="true">6.2.</strong> Building and running with wasmtime</a></li><li class="chapter-item expanded "><a href="tutorial/cli/image-filters.html"><strong aria-hidden="true">6.3.</strong> Image filter application</a></li><li class="chapter-item expanded "><a href="tutorial/cli/final-code.html"><strong aria-hidden="true">6.4.</strong> Final application</a></li></ol></li><li class="chapter-item expanded "><a href="tutorial/web.html"><strong aria-hidden="true">7.</strong> Web</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorial/web/hello-world.html"><strong aria-hidden="true">7.1.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="tutorial/web/wasm-bindgen.html"><strong aria-hidden="true">7.2.</strong> wasm-bindgen</a></li><li class="chapter-item expanded "><a href="tutorial/web/basic-setup.html"><strong aria-hidden="true">7.3.</strong> Basic setup</a></li><li class="chapter-item expanded "><a href="tutorial/web/image-filters.html"><strong aria-hidden="true">7.4.</strong> Image filter application</a></li><li class="chapter-item expanded "><a href="tutorial/web/frontend.html"><strong aria-hidden="true">7.5.</strong> HTML Frontend</a></li><li class="chapter-item expanded "><a href="tutorial/web/javascript.html"><strong aria-hidden="true">7.6.</strong> JavaScript</a></li><li class="chapter-item expanded "><a href="tutorial/web/run-locally.html"><strong aria-hidden="true">7.7.</strong> Running it locally</a></li><li class="chapter-item expanded "><a href="tutorial/web/final-code.html"><strong aria-hidden="true">7.8.</strong> Final application</a></li></ol></li><li class="chapter-item expanded "><a href="tutorial/edge.html"><strong aria-hidden="true">8.</strong> Edge computing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tutorial/edge/spec.html"><strong aria-hidden="true">8.1.</strong> Application specification</a></li><li class="chapter-item expanded "><a href="tutorial/edge/new-project.html"><strong aria-hidden="true">8.2.</strong> New project</a></li><li class="chapter-item expanded "><a href="tutorial/edge/handling-requests.html"><strong aria-hidden="true">8.3.</strong> Handling requests</a></li><li class="chapter-item expanded "><a href="tutorial/edge/backend.html"><strong aria-hidden="true">8.4.</strong> Backend</a></li><li class="chapter-item expanded "><a href="tutorial/edge/frontend.html"><strong aria-hidden="true">8.5.</strong> HTML Frontend</a></li><li class="chapter-item expanded "><a href="tutorial/edge/javascript.html"><strong aria-hidden="true">8.6.</strong> JavaScript</a></li><li class="chapter-item expanded "><a href="tutorial/edge/run-locally.html"><strong aria-hidden="true">8.7.</strong> Running it locally</a></li><li class="chapter-item expanded "><a href="tutorial/edge/final-code.html"><strong aria-hidden="true">8.8.</strong> Final application</a></li><li class="chapter-item expanded "><a href="tutorial/edge/deploy.html"><strong aria-hidden="true">8.9.</strong> Optional: Deployment</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="references.html"><strong aria-hidden="true">9.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Workbook for Rust &amp; QT workshop</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ferrous-systems/qt-training-2023" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rust--qt-workshop"><a class="header" href="#rust--qt-workshop">Rust &amp; QT workshop</a></h1>
<p>This workbook contains the material for a Rust &amp; QT workshop held by <a href="https://ferrous-systems.com/">Ferrous Systems</a>, developed and held together with <a href="https://kdab.com">KDAB</a>. It is based on work by <a href="https://fnordig.de/">Jan-Erik Rediger</a>.</p>
<p>It is split into 3 parts:</p>
<h2 id="part-1-setup"><a class="header" href="#part-1-setup">Part 1: <a href="preparations.html">Setup</a></a></h2>
<p>An installation guide for all tooling used throughout this book.</p>
<h2 id="part-2-background"><a class="header" href="#part-2-background">Part 2: <a href="what-is-webassembly.html">Background</a></a></h2>
<p>A bit of common knowledge &amp; history about WebAssembly and Rust,
as well as notable use cases.</p>
<h2 id="part-3-tutorial"><a class="header" href="#part-3-tutorial">Part 3: <a href="./tutorial/index.html">Tutorial</a></a></h2>
<p>A hands-on tutorial writing Rust and compiling it in 3 variations: as a command-line app, as a library and as a small QT app using the library using cxx-qt.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="preparations"><a class="header" href="#preparations">Preparations</a></h1>
<p>This chapter contains information about the course material and an installation guide.</p>
<h2 id="workshop-materials"><a class="header" href="#workshop-materials">Workshop Materials</a></h2>
<p>Clone the <a href="https://github.com/ferrous-systems/qt-training-2023">workshop git repository</a>:</p>
<pre><code>git clone https://github.com/ferrous-systems/qt-training-2023
</code></pre>
<p>The workshop repository contains all workshop materials, e.g. code examples,
and the source for this workbook.</p>
<h2 id="required-software"><a class="header" href="#required-software">Required Software</a></h2>
<p>The <a href="./setup.html">Setup guide</a> helps you install the required software used throughout this book.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup"><a class="header" href="#setup">Setup</a></h1>
<p>This section describes how to set up the toolchain
for compiling Rust programs to WebAssembly
and integrate them with the different environments we will look at.</p>
<h2 id="the-rust-toolchain"><a class="header" href="#the-rust-toolchain">The Rust Toolchain</a></h2>
<p>You will need the standard Rust toolchain, including <code>rustup</code>, <code>rustc</code>, and
<code>cargo</code>.</p>
<p><a href="https://www.rust-lang.org/tools/install">Follow these instructions to install the Rust toolchain.</a></p>
<p>This will install the Rust toolchain and the targets for the host platform.
Windows users need to choose between the <code>msvc</code> and <code>mingw</code> targets.
We recommend the <code>msvc</code> target, unless you already have <code>mingw</code> installed.</p>
<p>The course will only use the stable compiler, we don't require any experimental feature flags.
The latest Rust should work best, though older versions have no known issues.</p>
<h3 id="additional-tooling"><a class="header" href="#additional-tooling">Additional tooling</a></h3>
<p>For those interested in following the QT section of the course,
installation of QT is needed.</p>
<p>TODO: fill QT installation instructions</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tooling-check"><a class="header" href="#tooling-check">Tooling check</a></h1>
<h2 id="setup-check"><a class="header" href="#setup-check">Setup check</a></h2>
<p>✅ Fully restart your terminal (not just open a fresh tab).</p>
<p>✅ Let's check that you have installed Rust.</p>
<pre><code class="language-console">$ rustc --version
rustc 1.73.0 (cc66ad468 2023-10-03)
</code></pre>
<pre><code class="language-console">$ cargo --version
cargo 1.73.0 (9c4383fb5 2023-08-26)
</code></pre>
<p>✅ In a work directory, run:</p>
<pre><code class="language-console">$ cargo new --bin hello-world
$ cd hello-world
$ cargo run --release
   Compiling hello-world v0.1.0 (C:\Code\ferrous\hello-world)
    Finished release [optimized] target(s) in 0.99s
     Running `target\release\hello-world.exe`
Hello, world!
</code></pre>
<p>This ensures that the whole toolchain works correctly and finds the system linker. This should work at all times, if it doesn't, immediately ask for a trainer.</p>
<h1 id="qt-specifics"><a class="header" href="#qt-specifics">QT specifics</a></h1>
<p>TODO tool check for QT, compiling a hello world app.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-webassembly"><a class="header" href="#what-is-webassembly">What is WebAssembly?</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world"><a class="header" href="#hello-world">Hello World</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust--wasm"><a class="header" href="#rust--wasm">Rust &amp; Wasm</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="use-cases-on-the-web"><a class="header" href="#use-cases-on-the-web">Use cases on the web</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm--javascript"><a class="header" href="#wasm--javascript">WASM &amp; JavaScript</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="use-cases-everywhere-else"><a class="header" href="#use-cases-everywhere-else">Use cases everywhere else</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasi"><a class="header" href="#wasi">WASI</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fastlys-computeedge"><a class="header" href="#fastlys-computeedge">Fastly's Compute@Edge</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="idea"><a class="header" href="#idea">Idea</a></h1>
<p>We now want to build a slightly more complex application.</p>
<p>The idea is to use an existing image manipulation library
to apply filters to a given image<sup class="footnote-reference"><a href="#1">1</a></sup>.
This example will show us how to use an existing Rust crate,
how to handle input and output and how to interact with the different environments.</p>
<p>We start off with building a command-line tool run using <code>wasmtime</code>,
then build a web application running completely client-side,
and last as an edge computing API that processes images posted to it.</p>
<p>We will work with the following example image (but really any image will work).
Right-click it and save it to disk for later use.</p>
<p><img src="tutorial/kongelige-slott.jpg" alt="" /></p>
<p>When applying the filter named &quot;1977&quot;, this is the result:</p>
<p><img src="tutorial/kongelige-slott-1977.png" alt="" /></p>
<p>Several more filters are available in the library.</p>
<div class="footnote-definition" id="1"><sup class="footnote-definition-label">1</sup>
<p>The image filters are inspired by Instagram. The implementation is based on <a href="https://github.com/una/CSSgram">CSSgram</a>, which was ported to Rust by <a href="https://github.com/ha-shine">@ha-shine</a>. The example image was taken on 2022-10-28 by Jan-Erik Rediger.</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-interface"><a class="header" href="#command-line-interface">Command-line interface</a></h1>
<p>In this tutorial you'll get familiar with:</p>
<ul>
<li>Building Rust code for your local target</li>
<li>Running applications on the command-line</li>
<li>Re-using existing crates in your application</li>
</ul>
<p>We start with a command-line tool that takes an image and a filter name as input.
It applies the given filter to the image and produces an <code>output.png</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world-on-the-command-line"><a class="header" href="#hello-world-on-the-command-line">Hello World on the command line</a></h1>
<p>✅ Create a new Rust project</p>
<pre><code>cargo new rustagram
cd rustagram
</code></pre>
<p>✅ To start the tool will only print a message. Open <code>src/main.rs</code> and add</p>
<pre><code class="language-rust">fn main() {
    println!(&quot;Hello World from wasmtime!&quot;);
}</code></pre>
<p>Next, <a href="tutorial/cli/image-filters.html">start integrating image filters</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-and-running-with-wasmtime"><a class="header" href="#building-and-running-with-wasmtime">Building and running with wasmtime</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="image-filter-application"><a class="header" href="#image-filter-application">Image filter application</a></h1>
<p>Now that you can build and run an application compiled to WebAssembly,
it's time to build some functionality into it.</p>
<p>The goal is:</p>
<ul>
<li>Take an input file, a filter name and, optionally, an output file (or &quot;output.jpg&quot; as the default).</li>
<li>Load the input file, apply the given filter to this image, then write the resulting image to the output file.</li>
</ul>
<p>You can continue with the previously created project.</p>
<p>✅ Open <code>src/main.rs</code> again and replace the <code>println!</code> line with code to parse the arguments.</p>
<pre><code class="language-rust">fn main() {
    let mut args = std::env::args().skip(1);
    let input = args.next().expect(&quot;INPUT required&quot;);
    let filter = args.next().expect(&quot;FILTER required&quot;);
    let output = args.next().unwrap_or_else(|| &quot;output.jpg&quot;.to_string());

    dbg!((input, filter, output));
}</code></pre>
<p>✅ Build and run this to make sure it works as expected.</p>
<p>✅ Now add a dependency to handle image manipulation. The image filters are readily available in the <a href="https://crates.io/crates/rustagram2"><code>rustagram2</code></a> crate.
Add the <code>rustagram2</code> crate as a dependency in <code>rustagram/Cargo.toml</code></p>
<pre><code class="language-toml">[dependencies]
rustagram2 = &quot;2.0.0&quot;
</code></pre>
<p>The documentation is available on <a href="https://docs.rs/rustagram2/2.0.0/rustagram/">docs.rs/rustagram2</a>.</p>
<p>✅ You need a <a href="https://docs.rs/rustagram2/2.0.0/rustagram/enum.FilterType.html"><code>FilterType</code></a> to apply later.
<code>rustagram2</code> shows the available filters <a href="https://docs.rs/rustagram2/2.0.0/rustagram/enum.FilterType.html">in the <code>FilterType</code> documentation</a>.
It also has <a href="https://doc.rust-lang.org/nightly/core/str/trait.FromStr.html"><code>FromStr</code></a> from the standard library implemented for it, so you can parse strings into the filter type by calling <code>parse()</code> on the string.</p>
<pre><code class="language-rust">let filter_type = filter.parse().expect(&quot;can't parse filter name&quot;);</code></pre>
<p>An unknown filter name would cause an error.
For now you don't need to handle that.
Your application can just panic and exit.</p>
<p>If you compile everything at this point you will probably hit a type annotation error.
You can try to resolve that now.
You can also continue and observe how this error will be resolved once you add more code in the next steps.</p>
<p>Now comes the main part of the application: load the image, apply the filter and save the resulting file.
This is a small challenge for you to write, but the next steps guide you through it.</p>
<p>✅ You need to read the file from disk and turn it into an object you can work with.
<a href="https://docs.rs/image/0.24.4/image/fn.open.html"><code>image::open</code></a> does that for you easily.
Don't worry about error handling and just <code>unwrap</code>.</p>
<p>✅ The image type you get is able to represent a wide variety of image types.
For this tutorial you want an <a href="https://docs.rs/image/0.24.4/image/type.RgbaImage.html"><code>RgbaImage</code></a>. You can convert your image using the <a href="https://docs.rs/image/0.24.4/image/enum.DynamicImage.html#method.to_rgba8"><code>to_rgba8</code></a> method.</p>
<p>✅ Last but not least you need to apply the selected filter on this image.
The <code>rustagram2</code> crate implements that as the <a href="https://docs.rs/rustagram2/2.0.0/rustagram/trait.RustagramFilter.html#tymethod.apply_filter"><code>apply_filter</code></a> method on a trait.
This trait is automatically implemented for the <code>RgbaImage</code> type you got from <code>to_rgba8</code>.</p>
<p>✅ Save back to the file <code>output</code> by using the <a href="https://docs.rs/image/latest/image/enum.DynamicImage.html#method.save"><code>save</code></a> method available on the image.</p>
<p>With the help of the documentation this should be achievable in a couple of lines of code.</p>
<p>Try it for yourself!</p>
<p>✅ Once you wrote the code, build it again and try to run it.</p>
<p>Expected output when you don't pass any arguments:</p>
<pre><code class="language-console">$ cargo run
thread 'main' panicked at src\main.rs:5:29:
INPUT required
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>Expected output when you pass a file path and a filter name:</p>
<pre><code class="language-console">$ cargo run -- kongelige-slott.jpg 1977
    Finished dev [unoptimized + debuginfo] target(s) in 0.09s
     Running `target\debug\rustagram.exe kongelige-slott.jpg 1977`
thread 'main' panicked at src\main.rs:10:34:
called `Result::unwrap()` on an `Err` value: IoError(Os { code: 2, kind: NotFound, message: &quot;The system cannot find the file specified.&quot; })
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</code></pre>
<p>TODO: document positive case</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="final-application"><a class="header" href="#final-application">Final application</a></h1>
<p>You should have this file tree layout:</p>
<pre><code class="language-console">$ tree
.
├── Cargo.lock
├── Cargo.toml
└── src
    └── main.rs
</code></pre>
<p>To recap your final code should look something like this:</p>
<pre><code class="language-rust">use rustagram::{image, RustagramFilter};

fn main() {
    let mut args = std::env::args().skip(1);
    let input = args.next().expect(&quot;INPUT required&quot;);
    let filter = args.next().expect(&quot;FILTER required&quot;);
    let output = args.next().unwrap_or_else(|| &quot;output.jpg&quot;.to_string());

    let filter_type = filter.parse().expect(&quot;can't parse filter name&quot;);
    let img = image::open(input).unwrap();
    let out = img.to_rgba8().apply_filter(filter_type);
    out.save(output).unwrap();
}</code></pre>
<p>You can build your code like this:</p>
<pre><code>cargo build
</code></pre>
<p>And run it using cargo:</p>
<pre><code>cargo run
</code></pre>
<p>For an optimized build use:</p>
<pre><code>cargo build --release
</code></pre>
<pre><code>cargo run --release
</code></pre>
<hr />
<p>Some ideas on what to do next:</p>
<ul>
<li>Run the application natively: <code>cargo run</code>. Any complications or differences?</li>
<li>Heard of WebAssembly? You can actually run this in WebAssembly - see our <a href="https://github.com/ferrous-systems/wasm-training-2022">WASM Training</a></li>
<li>Try a full command line parser crate - see <a href="https://blessed.rs/crates#section-cli-tools-subsection-argument-parsing">blessed.rs for suggestions</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="web"><a class="header" href="#web">Web</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world-1"><a class="header" href="#hello-world-1">Hello World</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wasm-bindgen"><a class="header" href="#wasm-bindgen">wasm-bindgen</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="basic-setup"><a class="header" href="#basic-setup">Basic setup</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="image-filter-application-1"><a class="header" href="#image-filter-application-1">Image filter application</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="html-frontend"><a class="header" href="#html-frontend">HTML Frontend</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="javascript"><a class="header" href="#javascript">JavaScript</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-it-locally"><a class="header" href="#running-it-locally">Running it locally</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="final-application-1"><a class="header" href="#final-application-1">Final application</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="edge-computing"><a class="header" href="#edge-computing">Edge computing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="application-specification"><a class="header" href="#application-specification">Application specification</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="new-project"><a class="header" href="#new-project">New project</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="handling-requests"><a class="header" href="#handling-requests">Handling requests</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backend"><a class="header" href="#backend">Backend</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="html-frontend-1"><a class="header" href="#html-frontend-1">HTML Frontend</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="javascript-1"><a class="header" href="#javascript-1">JavaScript</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="running-it-locally-1"><a class="header" href="#running-it-locally-1">Running it locally</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="final-application-2"><a class="header" href="#final-application-2">Final application</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="optional-deployment"><a class="header" href="#optional-deployment">Optional: Deployment</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="references"><a class="header" href="#references">References</a></h1>
<p>TODO: Redo References</p>
<ul>
<li><a href="https://webassembly.org/">The official WebAssembly website</a></li>
<li><a href="https://rustwasm.github.io/docs/book/">The Rust Wasm Book</a></li>
<li><a href="https://rustwasm.github.io/docs/wasm-bindgen">wasm-bindgen documentation</a></li>
<li><a href="https://wasi.dev/">WASI website</a></li>
<li><a href="https://wasmtime.dev/">wasmtime website</a></li>
<li>Blog post: <a href="https://tung.github.io/posts/rust-and-webassembly-without-a-bundler/">Rust and WebAssembly without a Bundler</a></li>
<li>Image filter web app demo: <a href="https://tmp.fnordig.de/wasm/image-filter/">https://tmp.fnordig.de/wasm/image-filter/</a></li>
<li>Image filter edge computing demo: <a href="https://forcibly-advanced-eft.edgecompute.app/">https://forcibly-advanced-eft.edgecompute.app/</a></li>
<li><a href="https://docs.fastly.com/products/compute-at-edge">Fastly Compute@Edge documentation</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
